<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuesThink MCQ Generator</title>
    <style>
    
    </style>
</head>
<body>
    <link rel="stylesheet" href="style.css">
    <div class="container">
        <div class="header">
            <h1>üß† QuesThink</h1>
            <p>From PDFs to Practice: Generate MCQs with Intelligence</p>
        </div>

        <div class="main-content">
            <!-- Demo Section -->
            <div class="demo-section">
                <h3 class="demo-title">‚ú®Learn Smarter, Test Faster </h3>
                <p style="text-align: center; color: #6b7280; margin-bottom: 20px;">
                    Experience how the interactive MCQs work - select answers and check your results
                </p>
                
                <div class="questions-container" id="demoContainer">
                    <!-- Demo questions will be inserted here -->
                </div>
            </div>

            <div class="upload-section">
                <div class="file-input-wrapper">
                    <input type="file" id="pdfFile" class="file-input" accept=".pdf">
                    <button class="file-input-button">
                        üìÑ Choose PDF File
                    </button>
                </div>
                <div id="fileName" class="file-name"></div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="numQuestions">Number of Questions</label>
                    <input type="number" id="numQuestions" min="5" max="50" value="10" placeholder="Enter number of questions (5-50)">
                </div>
                <div class="form-group">
                    <label for="difficulty">Difficulty Level</label>
                    <select id="difficulty">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                        <option value="mixed">Mixed</option>
                    </select>
                </div>
            </div>

            <button id="generateBtn" class="generate-btn">Generate MCQs</button>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <div class="loading" id="loadingSection">
                <div class="loading-spinner"></div>
                <p>Analyzing your PDF and generating intelligent MCQs...</p>
                <p><small>This may take a few moments depending on the document size.</small></p>
            </div>

            <div class="results-section" id="resultsSection">
                <div class="results-header">
                    <div>
                        <h2>Generated MCQs</h2>
                        <span id="questionCount"></span>
                    </div>
                    <div class="results-actions">
                        <button class="action-btn" id="downloadPdfBtn">üìÑ Download PDF</button>
                        <button class="action-btn" id="downloadJsonBtn">üìÅ Export JSON</button>
                    </div>
                </div>
                <div class="questions-container" id="questionsContainer">
                    <!-- Generated questions will appear here -->
                </div>
            </div>
        </div>
    </div>
    <section class="features">
                <h2>Why Choose QuesThink?</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">ü§ñ</div>
                        <h3>AI-Powered</h3>
                        <p>Advanced natural language processing creates intelligent, contextually relevant questions
                            from your content</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üé®</div>
                        <h3>Customizable & Quick</h3>
                        <p>Choose difficulty levels, question count, and format. Create MCQs and interactive quizzes
                            tailored to your needs, lightning fast</p>
                    </div>
                    
            </section>
            <footer>
            <p>&copy; Made with ‚ù§ by BuildBeyond.</p>
        </footer>



    <script>
        class MCQGenerator {
            constructor() {
                this.baseUrl = 'http://localhost:5000';
                this.currentMCQData = null;
                this.initializeEventListeners();
                this.loadDemoQuestions();
            }

            initializeEventListeners() {
                const fileInput = document.getElementById('pdfFile');
                const generateBtn = document.getElementById('generateBtn');
                const downloadPdfBtn = document.getElementById('downloadPdfBtn');
                const downloadJsonBtn = document.getElementById('downloadJsonBtn');

                fileInput.addEventListener('change', this.handleFileSelect.bind(this));
                generateBtn.addEventListener('click', this.generateMCQs.bind(this));
                downloadPdfBtn.addEventListener('click', this.downloadPDF.bind(this));
                downloadJsonBtn.addEventListener('click', this.downloadJSON.bind(this));
            }

            // loadDemoQuestions() {
            //     const demoData = {
            //         questions: [
            //             {
            //                 question: "What is the primary function of mitochondria in a cell?",
            //                 options: {
            //                     A: "Protein synthesis",
            //                     B: "Energy production (ATP synthesis)",
            //                     C: "DNA replication",
            //                     D: "Waste removal"
            //                 },
            //                 correct_answer: "B",
            //                 explanation: "Mitochondria are often called the 'powerhouses of the cell' because they generate most of the ATP (adenosine triphosphate) through cellular respiration, which provides energy for cellular processes.",
            //                 topic: "Cell Biology",
            //                 difficulty: "medium"
            //             },
            //             {
            //                 question: "Which programming language is known for its use in machine learning and data science?",
            //                 options: {
            //                     A: "JavaScript",
            //                     B: "C++",
            //                     C: "Python",
            //                     D: "HTML"
            //                 },
            //                 correct_answer: "C",
            //                 explanation: "Python is widely used in machine learning and data science due to its extensive libraries like NumPy, Pandas, Scikit-learn, and TensorFlow, along with its readable syntax and strong community support.",
            //                 topic: "Programming",
            //                 difficulty: "easy"
            //             }
            //         ]
            //     };

            //     this.displayQuestionsInContainer(demoData, 'demoContainer');
            // }

            handleFileSelect(event) {
                const file = event.target.files[0];
                const fileNameDiv = document.getElementById('fileName');
                
                if (file) {
                    if (file.type !== 'application/pdf') {
                        this.showError('Please select a valid PDF file.');
                        return;
                    }
                    
                    if (file.size > 16 * 1024 * 1024) { // 16MB limit
                        this.showError('File size must be less than 16MB.');
                        return;
                    }
                    
                    fileNameDiv.textContent = `Selected: ${file.name} (${this.formatFileSize(file.size)})`;
                    fileNameDiv.style.display = 'block';
                    this.hideMessages();
                } else {
                    fileNameDiv.style.display = 'none';
                }
            }

            async generateMCQs() {
                const fileInput = document.getElementById('pdfFile');
                const numQuestions = document.getElementById('numQuestions').value;
                const difficulty = document.getElementById('difficulty').value;

                // Validation
                if (!fileInput.files[0]) {
                    this.showError('Please select a PDF file first.');
                    return;
                }

                if (numQuestions < 5 || numQuestions > 50) {
                    this.showError('Number of questions must be between 5 and 50.');
                    return;
                }

                this.showLoading(true);
                this.hideMessages();
                this.hideResults();

                const formData = new FormData();
                formData.append('pdf_file', fileInput.files[0]);
                formData.append('num_questions', numQuestions);
                formData.append('difficulty', difficulty);

                try {
                    const response = await fetch(`${this.baseUrl}/generate-mcq`, {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || 'Failed to generate MCQs');
                    }

                    if (data.success && data.data.questions) {
                        this.currentMCQData = data.data;
                        this.displayResults(data.data);
                        this.showSuccess(`Successfully generated ${data.data.questions.length} MCQs!`);
                    } else {
                        throw new Error('Invalid response format');
                    }

                } catch (error) {
                    console.error('Error:', error);
                    this.showError(`Error generating MCQs: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            displayResults(data) {
                const questionCount = document.getElementById('questionCount');
                const resultsSection = document.getElementById('resultsSection');

                questionCount.textContent = `${data.questions.length} questions generated`;
                
                this.displayQuestionsInContainer(data, 'questionsContainer');

                resultsSection.style.display = 'block';
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }

            displayQuestionsInContainer(data, containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';

                data.questions.forEach((question, index) => {
                    const questionCard = this.createQuestionCard(question, index + 1);
                    container.appendChild(questionCard);
                });
            }

            createQuestionCard(question, number) {
                const card = document.createElement('div');
                card.className = 'question-card';

                const difficultyColor = {
                    'easy': '#10b981',
                    'medium': '#f59e0b',
                    'hard': '#ef4444',
                    'mixed': '#8b5cf6'
                };

                card.innerHTML = `
                    <div class="result-indicator" id="result-${number}"></div>
                    <div class="question-header">
                        <div class="question-number">Q${number}</div>
                        <div class="question-meta">
                            <div>Topic: <strong>${question.topic || 'General'}</strong></div>
                            <div style="color: ${difficultyColor[question.difficulty] || '#6b7280'}">
                                Difficulty: <strong>${question.difficulty || 'Medium'}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="question-text">${question.question}</div>
                    
                    <div class="options-grid">
                        ${Object.entries(question.options).map(([key, value]) => `
                            <div class="option" data-option="${key}" data-question="${number}">
                                <strong>${key})</strong> ${value}
                            </div>
                        `).join('')}
                    </div>
                    
                    <button class="check-answer-btn" data-question="${number}" data-correct="${question.correct_answer}">
                        <span>üéØ</span> Check Answer
                    </button>
                    
                    ${question.explanation ? `
                        <div class="explanation" id="explanation-${number}">
                            <div class="explanation-label">
                                <span>üí°</span> Explanation:
                            </div>
                            <div class="explanation-text">${question.explanation}</div>
                        </div>
                    ` : ''}
                `;

                this.addInteractivity(card, number);
                return card;
            }

            addInteractivity(card, questionNumber) {
                const options = card.querySelectorAll('.option');
                const checkBtn = card.querySelector('.check-answer-btn');
                const explanation = card.querySelector(`#explanation-${questionNumber}`);
                const resultIndicator = card.querySelector(`#result-${questionNumber}`);
                
                let selectedOption = null;

                // Add click handlers to options
                options.forEach(option => {
                    option.addEventListener('click', () => {
                        if (option.classList.contains('disabled')) return;
                        
                        // Remove selection from all options
                        options.forEach(opt => opt.classList.remove('selected'));
                        
                        // Select clicked option
                        option.classList.add('selected');
                        selectedOption = option;
                        
                        // Enable check button
                        checkBtn.disabled = false;
                    });
                });

                // Add check answer functionality
                checkBtn.addEventListener('click', () => {
                    if (!selectedOption) {
                        alert('Please select an option first!');
                        return;
                    }

                    const correctAnswer = checkBtn.dataset.correct;
                    const selectedAnswer = selectedOption.dataset.option;
                    
                    // Disable all options and button
                    options.forEach(opt => opt.classList.add('disabled'));
                    checkBtn.disabled = true;
                    checkBtn.innerHTML = '<span>‚úÖ</span> Answer Checked';

                    // Show correct/incorrect styling
                    if (selectedAnswer === correctAnswer) {
                        selectedOption.classList.add('correct-answer');
                        // resultIndicator.textContent = '‚úÖ Correct!';
                        // resultIndicator.className = 'result-indicator correct';
                    } else {
                        selectedOption.classList.add('wrong-answer');
                        
                        // Highlight correct answer
                        const correctOption = card.querySelector(`[data-option="${correctAnswer}"]`);
                        if (correctOption) {
                            correctOption.classList.add('correct-answer');
                        }
                        
                    }

                    // Show explanation with animation
                    if (explanation) {
                        explanation.classList.add('show');
                    }
                });
            }

            async downloadPDF() {
                if (!this.currentMCQData) {
                    this.showError('No MCQ data available for download.');
                    return;
                }

                try {
                    const response = await fetch(`${this.baseUrl}/download-pdf`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(this.currentMCQData)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to generate PDF');
                    }

                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `MCQ_Report_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);

                } catch (error) {
                    console.error('Error:', error);
                    this.showError(`Error downloading PDF: ${error.message}`);
                }
            }

            async downloadJSON() {
                if (!this.currentMCQData) {
                    this.showError('No MCQ data available for export.');
                    return;
                }

                try {
                    const response = await fetch(`${this.baseUrl}/export-json`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(this.currentMCQData)
                    });

                    if (!response.ok) {
                        throw new Error('Failed to export JSON');
                    }

                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `MCQ_Data_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);

                } catch (error) {
                    console.error('Error:', error);
                    this.showError(`Error exporting JSON: ${error.message}`);
                }
            }

            showLoading(show) {
                const loadingSection = document.getElementById('loadingSection');
                const generateBtn = document.getElementById('generateBtn');
                
                loadingSection.style.display = show ? 'block' : 'none';
                generateBtn.disabled = show;
                generateBtn.textContent = show ? 'Generating...' : 'Generate MCQs';
            }

            showError(message) {
                const errorDiv = document.getElementById('errorMessage');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                setTimeout(() => this.hideMessages(), 5000);
            }

            showSuccess(message) {
                const successDiv = document.getElementById('successMessage');
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                setTimeout(() => this.hideMessages(), 3000);
            }

            hideMessages() {
                document.getElementById('errorMessage').style.display = 'none';
                document.getElementById('successMessage').style.display = 'none';
            }

            hideResults() {
                document.getElementById('resultsSection').style.display = 'none';
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }

        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new MCQGenerator();
        });
    </script>
</body>
</html>
